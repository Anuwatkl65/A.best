{% extends "production/base.html" %}
{% block title %}Scan Barcode{% endblock %}
{% block content %}
<h2 class="text-2xl font-bold mb-4 text-gray-800">Scan Barcode</h2>

<div class="bg-white rounded-xl p-4 shadow space-y-3">
  <div id="scan-result" class="text-sm text-gray-600">พร้อมสแกน</div>
  <div id="reader" class="w-64 h-64 border rounded-lg"></div>
  <div class="flex gap-2">
    <button id="test-scan-btn" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-500">ทดสอบส่งข้อมูล</button>
  </div>
</div>

<!-- ใช้โหมดทดสอบส่งข้อมูลแบบไม่ใช้กล้อง -->
<script>
  const SCRIPT_URL = "/api/";
  document.getElementById('test-scan-btn').onclick = async ()=>{
    const lot = prompt('ใส่ LOT ที่ต้องการส่ง (เช่น LOT-AB-0001):','TEST-LOT-001');
    if(!lot) return;
    document.getElementById('scan-result').textContent = `กำลังส่ง: ${lot}`;
    const res = await fetch(SCRIPT_URL,{method:'POST',body:new URLSearchParams({action:'scan',lot_no:lot,qty:1,machine_no:'MC-01'})});
    const j = await res.json();
    document.getElementById('scan-result').textContent = j.success||j.status==='success' ? `บันทึกสำเร็จ: ${lot}` : `ผิดพลาด: ${j.message||'unknown'}`;
  };
</script>
{% endblock %}
